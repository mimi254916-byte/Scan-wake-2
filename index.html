<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‚è∞ ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏õ‡∏•‡∏∏‡∏Å‡∏î‡πâ‡∏ß‡∏¢ QR</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { background:#000; color:#fff; font-family:sans-serif; text-align:center; padding:20px; }
    h1 { font-size:2em; margin-bottom:20px; }
    .time-display { font-size:4em; margin:20px 0; }
    .controls { margin:15px; }
    .controls input, .controls button { font-size:1.2em; padding:10px; margin:5px; }
    #progress { width:100%; height:20px; background:#333; margin:20px 0; border-radius:10px; overflow:hidden; }
    #progress-bar { width:0; height:100%; background:#4caf50; transition:width 0.5s; }
    #task, #registerQR { display:none; margin-top:20px; }
    #reader, #reader-register { width:300px; margin:auto; }
    audio { display:none; }
  </style>
</head>
<body>
  <h1>‚è∞ ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏õ‡∏•‡∏∏‡∏Å‡∏î‡πâ‡∏ß‡∏¢ QR</h1>

  <div class="time-display" id="currentTime">00:00:00</div>

  <div class="controls">
    <input type="time" id="alarmTime">
    <button onclick="setAlarm()">‡∏ï‡∏±‡πâ‡∏á‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤</button>
    <button onclick="startRegisterQR()">üì∑ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô QR</button>
  </div>

  <div id="progress"><div id="progress-bar"></div></div>
  <p id="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤</p>

  <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏õ‡∏•‡∏∏‡∏Å -->
  <div id="task">
    <h3>üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
    <div id="reader"></div>
  </div>

  <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô QR -->
  <div id="registerQR">
    <h3>üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h3>
    <div id="reader-register"></div>
  </div>

  <audio id="alarmSound" loop>
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  </audio>

  <script>
    let alarmTime = null;
    let alarmTimeout = null;
    let savedQR = null;
    let html5QrCode = null;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
    function updateTime() {
      const now = new Date();
      document.getElementById("currentTime").innerText =
        now.toLocaleTimeString('th-TH', { hour12:false });
      if (alarmTime) updateProgress(now);
    }
    setInterval(updateTime, 1000);

    // ‡∏ï‡∏±‡πâ‡∏á‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
    function setAlarm() {
      const input = document.getElementById("alarmTime").value;
      if (!input) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤"); return; }
      if (!savedQR) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô QR ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏õ‡∏•‡∏∏‡∏Å"); return; }
      alarmTime = input;
      document.getElementById("status").innerText = "‡∏ï‡∏±‡πâ‡∏á‡∏õ‡∏•‡∏∏‡∏Å‡πÄ‡∏ß‡∏•‡∏≤: " + alarmTime;
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô QR
    function startRegisterQR() {
      document.getElementById("registerQR").style.display = "block";
      html5QrCode = new Html5Qrcode("reader-register");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          savedQR = decodedText;
          alert("‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô QR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          html5QrCode.stop();
          document.getElementById("registerQR").style.display = "none";
        }
      );
    }

    // Progress bar
    function updateProgress(now) {
      const [h, m] = alarmTime.split(":").map(Number);
      const alarmDate = new Date();
      alarmDate.setHours(h, m, 0, 0);
      const diff = alarmDate - now;
      const total = 60 * 60 * 1000; // 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô
      let percent = Math.max(0, 100 - (diff/total*100));
      if (percent > 100) percent = 100;
      document.getElementById("progress-bar").style.width = percent + "%";

      if (diff <= 0 && !alarmTimeout) startAlarm();
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏∏‡∏Å
    function startAlarm() {
      document.getElementById("alarmSound").play();
      document.getElementById("status").innerText = "‚è∞ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
      document.getElementById("task").style.display = "block";

      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          if (decodedText === savedQR) stopAlarm();
        }
      );
    }

    // ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    function stopAlarm() {
      document.getElementById("alarmSound").pause();
      document.getElementById("alarmSound").currentTime = 0;
      document.getElementById("status").innerText = "‚úÖ ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
      document.getElementById("task").style.display = "none";
      if (html5QrCode) html5QrCode.stop();
      alarmTime = null;
      alarmTimeout = null;
    }
  </script>
</body>
</html>
